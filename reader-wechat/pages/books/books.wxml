<!-- pages/books/books.wxml -->
<view class="books-page">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input">
      <text class="search-icon">ğŸ”</text>
      <input 
        type="text" 
        placeholder="æœç´¢å›¾ä¹¦åç§°ã€ä½œè€…ã€ISBN" 
        value="{{keyword}}" 
        bindinput="onKeywordInput"
        bindconfirm="handleSearch"
      />
      <text 
        wx:if="{{keyword}}" 
        class="clear-icon" 
        bindtap="clearKeyword"
      >âœ•</text>
    </view>
    <button 
      class="search-btn" 
      type="primary" 
      size="mini" 
      bindtap="handleSearch"
    >
      æœç´¢
    </button>
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <scroll-view scroll-x="true" class="filter-scroll">
      <view 
        wx:for="{{categories}}" 
        wx:key="id" 
        class="filter-item {{selectedCategory === item.id ? 'active' : ''}}"
        bindtap="selectCategory"
        data-id="{{item.id}}"
      >
        {{item.name}}
      </view>
    </scroll-view>
  </view>

  <!-- æ’åºé€‰é¡¹ -->
  <view class="sort-bar">
    <text class="sort-label">æ’åºï¼š</text>
    <view class="sort-options">
      <view 
        class="sort-item {{sortBy === 'default' ? 'active' : ''}}"
        bindtap="sortBy"
        data-type="default"
      >
        é»˜è®¤
      </view>
      <view 
        class="sort-item {{sortBy === 'hot' ? 'active' : ''}}"
        bindtap="sortBy"
        data-type="hot"
      >
        çƒ­é—¨
      </view>
      <view 
        class="sort-item {{sortBy === 'publish_date' ? 'active' : ''}}"
        bindtap="sortBy"
        data-type="publish_date"
      >
        æœ€æ–°
      </view>
    </view>
  </view>

  <!-- å›¾ä¹¦åˆ—è¡¨ -->
  <view class="books-list">
    <view 
      wx:for="{{books}}" 
      wx:key="id" 
      class="book-item" 
      bindtap="goToBookDetail"
      data-id="{{item.id}}"
    >
      <image 
        src="{{getCoverUrl(item.cover)}}" 
        mode="aspectFill" 
        class="book-cover"
      />
      <view class="book-info">
        <text class="book-title">{{item.title}}</text>
        <text class="book-author">{{item.author}}</text>
        <text class="book-publisher">{{item.publisher}}</text>
        <view class="book-meta">
          <text class="book-category">{{item.category_name || 'æœªåˆ†ç±»'}}</text>
          <text class="book-borrow-count">å€Ÿé˜… {{item.borrow_count || 0}}æ¬¡</text>
        </view>
        <view class="book-status">
          <view 
            class="status-tag {{item.status === 1 ? 'available' : 'unavailable'}}"
          >
            {{item.status === 1 ? 'å¯å€Ÿ' : 'ä¸å¯å€Ÿ'}}
          </view>
          <text class="book-price">Â¥{{item.price}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore}}">
    <text bindtap="loadMore">ç‚¹å‡»åŠ è½½æ›´å¤š</text>
  </view>

  <!-- æ— æ•°æ®æç¤º -->
  <view class="empty-tip" wx:if="{{books.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“š</text>
    <text class="empty-text">æš‚æ— å›¾ä¹¦æ•°æ®</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-tip" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>