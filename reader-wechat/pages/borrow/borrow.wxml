<!-- pages/borrow/borrow.wxml -->
<view class="borrow-page">
  <!-- ç­›é€‰é€‰é¡¹ -->
  <view class="filter-bar">
    <view 
      class="filter-item {{filterStatus === 'all' ? 'active' : ''}}"
      bindtap="filterByStatus"
      data-status="all"
    >
      å…¨éƒ¨
    </view>
    <view 
      class="filter-item {{filterStatus === 'borrowed' ? 'active' : ''}}"
      bindtap="filterByStatus"
      data-status="borrowed"
    >
      å€Ÿé˜…ä¸­
    </view>
    <view 
      class="filter-item {{filterStatus === 'returned' ? 'active' : ''}}"
      bindtap="filterByStatus"
      data-status="returned"
    >
      å·²å½’è¿˜
    </view>
    <view 
      class="filter-item {{filterStatus === 'overdue' ? 'active' : ''}}"
      bindtap="filterByStatus"
      data-status="overdue"
    >
      å·²é€¾æœŸ
    </view>
  </view>

  <!-- å€Ÿé˜…åˆ—è¡¨ -->
  <view class="borrow-list">
    <view 
      wx:for="{{borrowRecords}}" 
      wx:key="id" 
      class="borrow-item"
      bindtap="goToBorrowDetail"
      data-id="{{item.id}}"
    >
      <view class="borrow-header">
        <text class="borrow-no">å€Ÿé˜…å·ï¼š{{item.borrow_no}}</text>
        <view 
          class="status-tag {{getStatusClass(item.status, item.due_date)}}"
        >
          {{getStatusText(item.status, item.due_date)}}
        </view>
      </view>
      <view class="book-info">
        <image src="{{getCoverUrl(item.cover)}}" mode="aspectFill" class="book-cover" />
        <view class="book-details">
          <text class="book-title">{{item.title}}</text>
          <text class="book-author">{{item.author}}</text>
          <view class="borrow-dates">
            <view class="date-item">
              <text class="date-label">å€Ÿé˜…æ—¥æœŸï¼š</text>
              <text class="date-value">{{item.borrow_date}}</text>
            </view>
            <view class="date-item">
              <text class="date-label">åº”è¿˜æ—¥æœŸï¼š</text>
              <text class="date-value {{isOverdue(item.due_date) ? 'overdue' : ''}}">{{item.due_date}}</text>
            </view>
            <view class="date-item" wx:if="{{item.return_date}}">
              <text class="date-label">å½’è¿˜æ—¥æœŸï¼š</text>
              <text class="date-value">{{item.return_date}}</text>
            </view>
          </view>
        </view>
      </view>
      <view class="borrow-actions">
        <button 
          wx:if="{{item.status === 'borrowed' && !isOverdue(item.due_date)}}"
          class="btn-renew"
          type="primary"
          size="mini"
          bindtap="handleRenew"
          data-id="{{item.id}}"
          catchtap="handleRenew"
        >
          ç»­å€Ÿ
        </button>
        <text wx:else class="action-text">
          {{item.status === 'borrowed' && isOverdue(item.due_date) ? 'å·²é€¾æœŸ' : 'æ— æ“ä½œ'}}
        </text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore}}">
    <text bindtap="loadMore">ç‚¹å‡»åŠ è½½æ›´å¤š</text>
  </view>

  <!-- æ— æ•°æ®æç¤º -->
  <view class="empty-tip" wx:if="{{borrowRecords.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“š</text>
    <text class="empty-text">æš‚æ— å€Ÿé˜…è®°å½•</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-tip" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>