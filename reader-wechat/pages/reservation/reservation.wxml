<!-- pages/reservation/reservation.wxml -->
<view class="reservation-page">
  <!-- ç­›é€‰é€‰é¡¹ -->
  <view class="filter-bar">
    <view 
      class="filter-item {{filterStatus === 'all' ? 'active' : ''}}"
      bindtap="filterByStatus"
      data-status="all"
    >
      å…¨éƒ¨
    </view>
    <view 
      class="filter-item {{filterStatus === 'pending' ? 'active' : ''}}"
      bindtap="filterByStatus"
      data-status="pending"
    >
      é¢„çº¦ä¸­
    </view>
    <view 
      class="filter-item {{filterStatus === 'completed' ? 'active' : ''}}"
      bindtap="filterByStatus"
      data-status="completed"
    >
      å·²å®Œæˆ
    </view>
    <view 
      class="filter-item {{filterStatus === 'cancelled' ? 'active' : ''}}"
      bindtap="filterByStatus"
      data-status="cancelled"
    >
      å·²å–æ¶ˆ
    </view>
  </view>

  <!-- é¢„çº¦åˆ—è¡¨ -->
  <view class="reservation-list">
    <view 
      wx:for="{{reservations}}" 
      wx:key="id" 
      class="reservation-item"
    >
      <view class="reservation-header">
        <text class="reservation-no">é¢„çº¦å·ï¼š{{item.appointment_no}}</text>
        <view 
          class="status-tag {{getStatusClass(item.status)}}"
        >
          {{getStatusText(item.status)}}
        </view>
      </view>
      <view class="book-info">
        <image src="{{getCoverUrl(item.cover)}}" mode="aspectFill" class="book-cover" />
        <view class="book-details">
          <text class="book-title">{{item.title}}</text>
          <text class="book-author">{{item.author}}</text>
          <view class="reservation-dates">
            <view class="date-item">
              <text class="date-label">é¢„çº¦æ—¥æœŸï¼š</text>
              <text class="date-value">{{item.appointment_date}}</text>
            </view>
            <view class="date-item" wx:if="{{item.completed_date}}">
              <text class="date-label">å®Œæˆæ—¥æœŸï¼š</text>
              <text class="date-value">{{item.completed_date}}</text>
            </view>
            <view class="date-item" wx:if="{{item.cancelled_date}}">
              <text class="date-label">å–æ¶ˆæ—¥æœŸï¼š</text>
              <text class="date-value">{{item.cancelled_date}}</text>
            </view>
          </view>
        </view>
      </view>
      <view class="reservation-actions">
        <button 
          wx:if="{{item.status === 'pending'}}"
          class="btn-cancel"
          type="default"
          size="mini"
          bindtap="handleCancel"
          data-id="{{item.id}}"
        >
          å–æ¶ˆé¢„çº¦
        </button>
        <text wx:else class="action-text">
          {{getStatusText(item.status)}}
        </text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore}}">
    <text bindtap="loadMore">ç‚¹å‡»åŠ è½½æ›´å¤š</text>
  </view>

  <!-- æ— æ•°æ®æç¤º -->
  <view class="empty-tip" wx:if="{{reservations.length === 0 && !loading}}">
    <text class="empty-icon">ğŸ“š</text>
    <text class="empty-text">æš‚æ— é¢„çº¦è®°å½•</text>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-tip" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>